%pkg unload control;
%addpath(genpath('~/Sys/opt/matlab/ident'));
%addpath(genpath('~/Sys/opt/matlab/control'));

%randn("seed",5489)
%nobs = 50;
%u = sign(randn(nobs,1)); % input
u = [ 1;  1; -1;  1;  1; -1; -1;  1; 1;  1; ...
	 -1;  1;  1; -1;  1; -1; -1;  1; 1;  1; ...
	  1; -1;  1;  1;  1;  1;  1; -1; 1; -1; ...
	  1; -1; -1; -1; -1;  1;  1; -1; 1; -1; ...
	 -1; -1;  1;  1; -1; -1; -1;  1; 1;  1]; % input
nobs = length(u);
th0 = idpoly([1 -1.5 0.7],[0.2 1 0.5]); % a low order idpoly model
y = sim(th0,u);
%y = [0.2;1.5;3.41;3.765;3.9605;4.60525;3.435525;0.629612500000002;-0.760448749999998;0.118598125000002;2.0102113125;2.63229828125;3.241299503125;4.3193404578125;3.91010103453125;3.14161323132813;1.27534912282031;-1.58610557769922;-2.57190275252305;-1.04758022439512;1.92896159017346;4.92674854233677;5.73984970038373;5.86105057093986;6.47368106614118;7.30778619955387;8.13010255303197;8.37970348986026;6.578483447668;4.30193272859982;1.54796067953213;-0.389411890721674;-2.36769031175501;-4.97894714412734;-7.5110374979625;-9.08129324605462;-7.66421362050817;-3.83941515852403;-0.694173203430321;1.94633080582134;2.70541745113323;0.99569461262491;-1.7002502968559;-2.54736167412128;-1.3308673033828;-0.913147783189296;-2.13811456241599;-3.86796839539147;-3.60527239939602;-1.00033072232]

z = iddata(y,u);
plot(z) % analysis data object

ff = 0.98; % forgetting factor
nn = [2 3 1]; % model order
yh=[];
[th,yh(1),p,phi] = rarx(z(1,:),nn,'ff',ff);
plot(1,th(1),'*',1,th(2),'+',1,th(3),'o',1,th(4),'*'),
axis([1 nobs -2 2]),title('Estimated Parameters'),drawnow
hold on;
for kkk = 2:nobs
    [th,yh(kkk),p,phi] = rarx(z(kkk,:),nn,'ff',ff,th',p,phi);
    plot(kkk,th(1),'*',kkk,th(2),'+',kkk,th(3),'o',kkk,th(4),'*')
end
hold off
